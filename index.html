<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <meta name="theme-color" content="#0d0f14" />
    <title>MECHANISM â€” Systems Learning Platform</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- â•â•â• TOP BAR â•â•â• -->
    <header id="top-bar">
      <div id="logo">âš™ MECHANISM</div>

      <nav id="track-nav">
        <button class="track-btn active" data-track="t1">
          Track 1 Â· Hardware
        </button>
        <button class="track-btn" data-track="t2">Track 2 Â· Backend</button>
      </nav>

      <div id="step-controls">
        <button id="btn-reset" title="Reset">â†º</button>
        <button id="btn-step" title="Step">â–¶|</button>
        <button id="btn-run" title="Run">â–¶</button>
        <span id="step-counter">step 0</span>
        <label>
          <span id="speed-label-txt">Speed</span>
          <input
            type="range"
            id="speed-slider"
            min="100"
            max="2000"
            value="600"
            step="100"
          />
        </label>
      </div>
    </header>

    <!-- â•â•â• APP BODY â•â•â• -->
    <div id="app-body">
      <!-- Left sidebar / mobile drawer -->
      <nav id="module-list">
        <div class="track-label" id="t1-label">Track 1 Â· Hardware</div>
        <div id="t1-modules"></div>
        <div class="track-label" id="t2-label" style="display: none">
          Track 2 Â· Backend
        </div>
        <div id="t2-modules" style="display: none"></div>
      </nav>

      <!-- Main simulation canvas -->
      <main id="stage">
        <div id="stage-placeholder">
          <div class="placeholder-inner">
            <div class="placeholder-icon">âš™</div>
            <h2>Select a module</h2>
            <p>
              Each module is a runnable simulation.<br />
              Use <strong>Step</strong> to advance one tick,<br />
              or <strong>Run</strong> to animate.
            </p>
          </div>
        </div>
      </main>

      <!-- Right inspector / mobile drawer -->
      <aside id="inspector">
        <section class="panel" id="state-panel">
          <h3>â–¸ State</h3>
          <div class="panel-body">
            <pre id="state-dump">â€”</pre>
          </div>
        </section>
        <section class="panel" id="control-panel">
          <h3>â–¸ Controls</h3>
          <div class="panel-body">
            <div id="dynamic-controls"><em>Select a module</em></div>
          </div>
        </section>
        <section class="panel" id="failure-panel">
          <h3>â–¸ Inject Failure</h3>
          <div class="panel-body">
            <div id="failure-controls"><em>No module loaded</em></div>
          </div>
        </section>
        <section class="panel" id="log-panel">
          <h3>â–¸ Event Log</h3>
          <div class="panel-body">
            <ul id="event-log"></ul>
          </div>
        </section>
      </aside>
    </div>
    <!-- /#app-body -->

    <!-- â•â•â• TABLET: inspector slide toggle â•â•â• -->
    <button
      id="inspector-toggle"
      onclick="toggleInspector()"
      title="Toggle inspector"
    >
      Inspector â–¸
    </button>

    <!-- â•â•â• MOBILE: bottom navigation bar â•â•â• -->
    <nav id="bottom-bar">
      <button
        class="bottom-tab active"
        id="tab-modules"
        onclick="mobileTab('modules')"
      >
        <span class="tab-icon">â˜°</span>Modules
      </button>
      <button class="bottom-tab" id="tab-sim" onclick="mobileTab('sim')">
        <span class="tab-icon">âš™</span>Simulation
      </button>
      <button
        class="bottom-tab"
        id="tab-inspector"
        onclick="mobileTab('inspector')"
      >
        <span class="tab-icon">ðŸ”¬</span>Inspector
      </button>
    </nav>

    <script>
      /* â”€â”€ Mobile & tablet UI helpers â”€â”€ */
      let _activeTab = "modules";

      function mobileTab(tab) {
        _activeTab = tab;
        document
          .querySelectorAll(".bottom-tab")
          .forEach((b) => b.classList.remove("active"));
        document.getElementById("tab-" + tab).classList.add("active");

        const modList = document.getElementById("module-list");
        const inspector = document.getElementById("inspector");

        if (tab === "modules") {
          modList.classList.toggle("open");
          inspector.classList.remove("open");
        } else if (tab === "inspector") {
          inspector.classList.toggle("open");
          modList.classList.remove("open");
        } else {
          modList.classList.remove("open");
          inspector.classList.remove("open");
        }
      }

      function toggleInspector() {
        const inspector = document.getElementById("inspector");
        const toggle = document.getElementById("inspector-toggle");
        inspector.classList.toggle("open");
        toggle.textContent = inspector.classList.contains("open")
          ? "Inspector â—‚"
          : "Inspector â–¸";
      }

      /* Close drawers when clicking on stage (mobile) */
      document.addEventListener("click", (e) => {
        if (window.innerWidth > 767) return;
        const ml = document.getElementById("module-list");
        const ins = document.getElementById("inspector");
        const bar = document.getElementById("bottom-bar");
        if (!ml.contains(e.target) && !bar.contains(e.target))
          ml.classList.remove("open");
        if (!ins.contains(e.target) && !bar.contains(e.target))
          ins.classList.remove("open");
      });
    </script>

    <script src="app.js"></script>
  </body>
</html>
